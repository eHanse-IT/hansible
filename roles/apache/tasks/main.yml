---
- name: Task - Install Apache Webserver
  apt:
    name: apache2
    update_cache: yes
    state: present

- name: Task - Enable Apache modules (partly req for Odoo)
  apache2_module:
    name: {{ item }}
    state: present
  with_items:
   - rewrite
   - ssl
   - proxy
   - filter
   - headers # req. for Odoo multi DB

- name: Task - Let Apache2 listen on 80 and 443
  template:
    src: templates/ports.conf.j2
    dest: /etc/apache2/ports.conf
    owner: root
    group: root
    mode: 0644
  notify: restart_apache2_event

- name: Task - Remove default Apache2 virtualhost file.
  file:
  path: "/etc/apache2/sites-enabled/000-default.conf"
  state: absent
  notify: restart_apache2_event

- name: Task - Secure Apache2 Step 1 - replace default index.html
  template:
    src: templates/index.html.j2
    dest: /var/www/html/index.html
    owner: www-data
    group: www-data
    mode: 0644
  notify: restart_apache2_event

- name: Task - Secure Apache2 Step 2 - edit




# secure apache according Cookboook
# remove default virtual hosts
# --> now apache is prepared and able to receive further vhosts

# Hinzuf√ºgen von VHosts: immer die vhost-Datei nach sites-available
# kopieren UND dann einen Link bei sites-enabled erstellen

#- name: Add Apache virtualhost for Drupal 8 development.
#template:
#src: "templates/drupal.dev.conf.j2"
#dest: "/etc/apache2/sites-available/{{ domain }}.dev.conf"
#owner: root
#group: root
#mode: 0644
#notify: restart apache

#- name: Symlink Drupal virtualhost to sites-enabled.
#file:
#src: "/etc/apache2/sites-available/{{ domain }}.dev.conf"
#dest: "/etc/apache2/sites-enabled/{{ domain }}.dev.conf"
#state: link
#notify: restart apache




