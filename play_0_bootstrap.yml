---

# Dieses Playbook dient dazu, einen erstmaligen Login mit dem User 'root'
# durchzuf端hren, um genau einen Task auszuf端hren: unsere SSH User einzurichten.
# Alle weiteren Konfigschritte werden dann in den restlichen Playbooks gemacht.
#
# Nutzung (am Beispiel des Servers 185.170.113.205):
#
# 1. SSH Key entfernen:
#    ssh-keygen -f "/home/joerg/.ssh/known_hosts" -R 185.170.113.205
# 2. Einmal via Terminal als SSH einen Loginversuch machen, um den neuen key zu holen:
#    ssh root@185.170.113.205
# 3. Bootstrap Playbook ausf端hren mit --ask-pass ausf端hren:
#    ansible-playbook play_0_bootstrap.yml -i inventory.yml -u root -b -K --vault-password-file=.vaultpw -l ehtest --ask-pass

- name: play_0_bootstrap - Users und SSH einrichten
  hosts: all
  vars_files:
   - vars
   - vault
  gather_facts: false # verhindert error auf uninitialisierten Servern
  pre_tasks:
  - name: setze ansible port auf 22
    set_fact:
      ansible_port: "22"
  - name: setze ansible user auf root
    set_fact:
      ansible_user: root
  - name: Ensure Python is installed to run ansible tasks
    raw: command -v apt-get >/dev/null 2>&1 && apt-get update && apt-get -y install python-minimal
    changed_when: false
    ignore_errors: "yes"
    tags: python
  roles:
  - users
  - ssh

  post_tasks:
  - name: setze gather facts wieder auf 'on' setzen durch das aufrufen von 'setup:'
    setup:
    tags: python


