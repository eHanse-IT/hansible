---
# This file manages our servers and their variables.
# For each server, we declare the server-dependent variables that are required for the roles.
# 1. oatrade group:
#    - oaprod
#    - oatest
#    - godalko
# 3. eHanse group:
#    - ehprod
#    - ehtest
#    - jupyter

ehanse:
  vars:
    pipelining: true
    timezone: "Europe/Berlin"
    userlist:
      - "{{ ehanse_users }}"
    #SSMTP critical variables:
    host_ssmtp_root: "{{ _vault_ssmtp_AuthUser }}"
    host_ssmtp_host: "{{ _vault_ssmtp_host }}"
    host_ssmtp_port: "{{ _vault_ssmtp_port }}"
    host_ssmtp_hostname: "{{ domains[0].vhost }}"
    host_ssmtp_AuthUser: "{{ _vault_ssmtp_AuthUser }}"
    host_ssmtp_AuthPass: "{{ _vault_ssmtp_AuthPass }}"
    # FAIL2BAN critical variables:
    host_fail2ban_bantime:  600
    host_fail2ban_maxretry: 10
    host_fail2ban_findtime: 3600
    fail2ban_services:
      - name: sshd
        port: "{{ host_port }}"
        #- name: apache-auth
        #  port: http, https
        #- name: apache-overflows
        #  port: http, https
        #- name: apache-badbots
        #  port: http, https
    # ODOO critical variables:
    odoo_config_admin_passwd:           "{{ _vault_odoo_config_superadmin_password_ehanse }}"
    odoo_config_db_filter:              ^%d$       # database name must equal subdomain '.*'. Do not forget CERTBOT!
    odoo_config_list_db:                True
    odoo_config_logrotate:              True
    odoo_config_proxy_mode:             True
    odoo_user_shell:                    /bin/bash
    odoo_user_system:                   False
    odoo_config_addons_path:
      - "/home/{{ odoo_user }}/odoo/custom/"       # muss eine Liste sein
    odoo_config_logfile:                /var/log/odoo/odoo-server.log
    odoo_config_smtp_server:            "{{ _vault_odoo_config_smtp_server }}"
    odoo_config_smtp_port:              "{{ _vault_odoo_config_smtp_port }}"
    odoo_config_smtp_ssl:               "{{ _vault_odoo_config_smtp_ssl }}"
    odoo_config_smtp_user:              "{{ _vault_odoo_config_smtp_user }}"
    odoo_config_smtp_password:          "{{ _vault_odoo_config_smtp_password }}"
    odoo_config_limit_memory_hard:      2684354560 # calculate min. 324MB RAM per worker: 324 * 5 *1024 * 1024 =
    odoo_config_limit_memory_soft:      2147483648
    odoo_config_limit_request:          8192       #Values added by Frank
    odoo_config_limit_time_cpu:         600        #Frank should recheck
    odoo_config_limit_time_real:        1200
    odoo_config_limit_time_real_cron:   -1         # enables cronjobs to run longer after Odoo 10
    odoo_config_longpolling_port:       8072
    odoo_config_max_cron_threads:       1          # each cron thread needs his own worker
    odoo_config_workers:                0          # max. workers = (Anzahl CPU *2) + 1 . We need 1 worker per 6 users and 1 for cron

  hosts:
    any_localhost:
      ansible_host: 127.0.0.1
      connection: local
    ehprod:
      ansible_host: "{{ _vault_ehprod_ip }}"
      ansible_port: "{{ host_port }}"
      fqdn: "www.ehanse.de"
      hostname: "ehprod"
      domains:
        - {vhost: "www.ehanse.de", type: "odoo"}
        - {vhost: "test1.ehanse.de", type: "odoo"}
        - {vhost: "test2.ehanse.de", type: "odoo"}
        - {vhost: "wiki.ehanse.de", type: "wiki"}
        - {vhost: "seafile.ehanse.de", type: "seafile"}
        - {vhost: "mail.ehanse.de", type: "mailforwarder", webmail_address: "hosted.mailcow.de"}
      certbot_create_standalone_stop_services:
        - apache2
      odoo_config_db_name:  www
    ehtest:
      ansible_host: "{{ _vault_ehtest_ip }}"
      ansible_port: "{{ host_port }}"
      fqdn: "testsys1.ehanse.de"
      hostname: "ehtest"
      domains:
        - {vhost: "testsys1.ehanse.de", type: "odoo"}
        - {vhost: "testsys2.ehanse.de", type: "wiki"}
        - {vhost: "testsys3.ehanse.de", type: "seafile"}
        - {vhost: "testsys4.ehanse.de", type: "mailforwarder", webmail_address: "hosted.mailcow.de"}
      certbot_create_standalone_stop_services:
        - apache2
      odoo_config_db_name:  testsys1



oatrade:
  hosts:
    twprod:
      # Ansible cirtical variables
      pipelining: False              # TODO kann auf TRUE gesetzt werden wenn Ubuntu 16+04 oder neuer installiert
      ansible_host: "{{ _vault_twprod_ip }}"
      ansible_port: "{{ host_port }}"
      #play_0_bootstrap critical variables
      userlist:
      - "{{ ehanse_users }}"
      - "{{ rfhk_users }}"
      # play_1_essentials critical variables
      fqdn: "oaprod.oa-trade.com"
      hostname: "oaprod"
      timezone: "Asia/Hong_Kong"
      #play_2_apache critical variables
      domain: "oa.oa-trade.com"
      domainAliases: "erp.oa-trade.com"
      certbot_admin_email: info@ehanse.de
      certbot_certs:
       - domains:
          - oa.oa-trade.com
      certbot_create_standalone_stop_services:
        - apache2
      #play_3_odoo critical variables (also uses domain info from above)
      odoo_version: 8.0
      odoo_config_addons_path:
      - "/home/{{ odoo_user }}/odoo/server/addons"
      - "/home/{{ odoo_user }}/odoo/custom/OAW-custom"
      - "/home/{{ odoo_user }}/odoo/custom/awo-custom"
      odoo_config_smtp_password: "{{ _vault_oatrade_odoo_config_smtp_password }}"
      odoo_config_smtp_port: 587
      odoo_config_smtp_server: s1.hostedmail.cc
      odoo_config_smtp_ssl: True
      odoo_config_smtp_user: erp@oawatches.net


    chrono123:
      #Ansible critical variables
      ansible_host: "{{ _vault_chrono123_ip }}"
      ansible_port: "{{ host_port }}"
      #play_0_bootstrap critical variables
      userlist:
      - "{{ ehanse_users }}"
      - "{{ rfhk_users }}"
      #play_1_essentials critical variables
      fqdn: "godalko.com"
      hostname: "godalko.com"
      timezone: "Asia/Hong_Kong"
      #play_2_apache critical variables
      domain: "go.godalko.com"   #f√ºr Odoo VHost
      domainAliases: "godalko.com www.godalko.com"
      certbot_admin_email: info@godalko.com
      certbot_certs:
       - domains:
          - chrono123.com
          - go.godalko.com
          - godalko.com
          - www.godalko.com
          - www.chrono123.com
          - backend.chrono123.com
      certbot_create_standalone_stop_services:
        - apache2
      odoo_version: 8.0
      odoo_config_addons_path:
      - "/home/{{ odoo_user }}/odoo/server/addons"
      - "/home/{{ odoo_user }}/odoo/custom/OAW-custom"
      - "/home/{{ odoo_user }}/odoo/custom/awo-custom"
      odoo_config_smtp_password: somepassword                       #TODO
      odoo_config_smtp_port: 587
      odoo_config_smtp_server: somesmtpserver.com                   #TODO
      odoo_config_smtp_ssl: True                                    #TODO
      odoo_config_smtp_user: erp@oawatches.net                      #TODO

    twtest:
      ansible_host: "{{ _vault_twtest_ip }}"
      ansible_port: "{{ host_port }}"
      fqdn: "test.oa-trade.com"
      hostname: "oatest"
      timezone: "Asia/Hong_Kong"
      domain: "oatest.oa-trade.com"
      certbot_admin_email: info@godalko.com
      certbot_certs:
       - domains:
          - oatest.oa-trade.com
      certbot_create_standalone_stop_services:
        - apache2
      userlist:
      - "{{ ehanse_users }}"
      - "{{ rfhk_users }}"
      odoo_version: 8.0
      odoo_config_addons_path:
      - "/home/{{ odoo_user }}/odoo/server/addons"
      - "/home/{{ odoo_user }}/odoo/custom/OAW-custom"
      - "/home/{{ odoo_user }}/odoo/custom/awo-custom"
      odoo_config_smtp_password: somepassword                       #TODO
      odoo_config_smtp_port: 587
      odoo_config_smtp_server: somesmtpserver.com                   #TODO
      odoo_config_smtp_ssl: True                                    #TODO
      odoo_config_smtp_user: erp@oawatches.net                      #TODO

      #play_6_ssmtp critical variables
      host_ssmtp_root: "{{ _vault_ssmtp_AuthUser }}"
      host_ssmtp_mailhub: "{{ _vault_ssmtp_mailhub }}"
      host_ssmtp_hostname: "{{ domain }}"
      host_ssmtp_AuthUser: "{{ _vault_ssmtp_AuthUser }}"
      host_ssmtp_AuthPass: "{{ _vault_ssmtp_AuthPass }}"

      # play_7_fail2ban critical services
      fail2ban_services:
      - name: sshd
        port: "{{ host_port }}"
      - name: apache-auth
        port: http, https
      - name: apache-overflows
        port: http, https
      - name: apache-badbots
        port: http, https








      












